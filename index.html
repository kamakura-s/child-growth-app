<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>すくすくノート | 子どもの成長記録</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body data-theme="light">
  <div class="bg-decor" aria-hidden="true"></div>

  <header class="container hero">
    <div>
      <h1>すくすくノート</h1>
      <p class="subtitle">子どもの成長を、写真・体格・メモでやさしく記録</p>
      <p class="privacy-note">🔒 このアプリのデータはこのブラウザの <strong>localStorage</strong> に保存されます（クラウド送信なし）。</p>
    </div>
    <div class="hero-pill">SPA / Local First</div>
  </header>

  <main class="container app-shell">
    <nav class="tabs" aria-label="アプリメニュー" role="tablist">
      <button id="tab-btn-profile" type="button" class="tab-btn active" data-tab="profile" role="tab" aria-selected="true" aria-controls="tab-profile" tabindex="0">プロフィール</button>
      <button id="tab-btn-growth" type="button" class="tab-btn" data-tab="growth" role="tab" aria-selected="false" aria-controls="tab-growth" tabindex="-1">成長記録</button>
      <button id="tab-btn-diary" type="button" class="tab-btn" data-tab="diary" role="tab" aria-selected="false" aria-controls="tab-diary" tabindex="-1">日記</button>
      <button id="tab-btn-graph" type="button" class="tab-btn" data-tab="graph" role="tab" aria-selected="false" aria-controls="tab-graph" tabindex="-1">グラフ</button>
      <button id="tab-btn-settings" type="button" class="tab-btn" data-tab="settings" role="tab" aria-selected="false" aria-controls="tab-settings" tabindex="-1">設定</button>
    </nav>

    <p id="appError" class="error app-error" role="alert"></p>
    <p id="srAnnouncer" class="sr-only" aria-live="assertive" aria-atomic="true"></p>
    <p id="saveStatus" class="save-status idle" aria-live="polite">保存準備完了</p>

    <section id="tab-profile" class="tab-panel active" role="tabpanel" aria-labelledby="tab-btn-profile">
      <article class="card">
        <h2>プロフィール登録</h2>
        <form id="profileForm" class="form" novalidate>
          <label>お名前 <span class="req">*</span>
            <input type="text" id="childName" maxlength="30" required placeholder="例: はな" />
          </label>
          <label>生年月日 <span class="req">*</span>
            <input type="date" id="birthDate" required />
          </label>
          <label>メモ
            <textarea id="profileNote" rows="2" maxlength="120" placeholder="好きな食べ物など"></textarea>
          </label>
          <p class="error" id="profileError"></p>
          <button type="submit" class="btn btn-primary">プロフィールを保存</button>
        </form>
        <div id="profileView" class="profile-view"></div>
      </article>
    </section>

    <section id="tab-growth" class="tab-panel" role="tabpanel" aria-labelledby="tab-btn-growth">
      <article class="card">
        <h2>身長・体重の記録</h2>
        <form id="growthForm" class="form two-col" novalidate>
          <label>日付 <span class="req">*</span>
            <input type="date" id="recordDate" required />
          </label>
          <label>カテゴリ
            <select id="growthCategory">
              <option value="health">健康</option>
              <option value="meal">食事</option>
              <option value="sleep">睡眠</option>
              <option value="play">遊び</option>
              <option value="other">その他</option>
            </select>
          </label>
          <label>身長 (cm) <span class="req">*</span>
            <input type="number" id="height" min="30" max="220" step="0.1" required placeholder="例: 92.4" />
          </label>
          <label>体重 (kg) <span class="req">*</span>
            <input type="number" id="weight" min="1" max="120" step="0.1" required placeholder="例: 13.6" />
          </label>
          <fieldset class="choice-group">
            <legend>体調</legend>
            <div id="growthConditionChoices" class="choice-options" role="radiogroup" aria-label="体調選択">
              <label><input type="radio" name="growthCondition" value="good" checked /> 元気</label>
              <label><input type="radio" name="growthCondition" value="normal" /> ふつう</label>
              <label><input type="radio" name="growthCondition" value="tired" /> つかれ気味</label>
              <label><input type="radio" name="growthCondition" value="sick" /> 体調不良</label>
            </div>
          </fieldset>
          <label>タグ（カンマ区切り）
            <input type="text" id="growthTags" maxlength="120" placeholder="例: 発熱,病院" />
            <div id="growthTagSuggestions" class="tag-suggestions" aria-label="タグ候補"></div>
          </label>
          <label>メモ
            <input type="text" id="growthMemo" maxlength="80" placeholder="体調や出来事" />
          </label>
          <label class="full inline-toggle">
            <input type="checkbox" id="continuousGrowthMode" />
            連続入力モード（保存後にフォームをリセットしない）
          </label>
          <p class="error full" id="growthError"></p>
          <button type="submit" class="full btn btn-primary">記録を追加</button>
        </form>
      </article>

      <article class="card">
        <h3>検索・絞り込み（成長記録）</h3>
        <form id="growthFilterForm" class="form two-col" novalidate>
          <label>開始日
            <input type="date" id="growthFilterFrom" />
          </label>
          <label>終了日
            <input type="date" id="growthFilterTo" />
          </label>
          <label>カテゴリ
            <select id="growthFilterCategory">
              <option value="">すべて</option>
              <option value="health">健康</option>
              <option value="meal">食事</option>
              <option value="sleep">睡眠</option>
              <option value="play">遊び</option>
              <option value="other">その他</option>
            </select>
          </label>
          <label>キーワード
            <input type="text" id="growthFilterKeyword" placeholder="メモ・タグを検索" />
          </label>
          <label class="full">タグ
            <input type="text" id="growthFilterTag" placeholder="例: 病院" />
          </label>
          <div class="full inline-actions">
            <button type="reset" class="btn btn-secondary">絞り込みをクリア</button>
          </div>
        </form>
      </article>

      <article class="card">
        <h3>身長・体重 一覧</h3>
        <div id="growthList" class="list"></div>
      </article>
    </section>

    <section id="tab-diary" class="tab-panel" role="tabpanel" aria-labelledby="tab-btn-diary">
      <article class="card">
        <h2>写真付き日記メモ</h2>
        <form id="diaryForm" class="form" novalidate>
          <label>日付 <span class="req">*</span>
            <input type="date" id="diaryDate" required />
          </label>
          <label>タイトル <span class="req">*</span>
            <input type="text" id="diaryTitle" required maxlength="50" placeholder="例: 公園で遊んだ" />
          </label>
          <label>カテゴリ
            <select id="diaryCategory">
              <option value="event">イベント</option>
              <option value="health">健康</option>
              <option value="meal">食事</option>
              <option value="play">遊び</option>
              <option value="other">その他</option>
            </select>
          </label>
          <label>タグ（カンマ区切り）
            <input type="text" id="diaryTags" maxlength="120" placeholder="例: 公園,友だち" />
            <div id="diaryTagSuggestions" class="tag-suggestions" aria-label="タグ候補"></div>
          </label>
          <label>内容 <span class="req">*</span>
            <textarea id="diaryText" rows="3" required maxlength="300"></textarea>
          </label>
          <label>写真（任意・最大2MB）
            <input type="file" id="diaryPhoto" accept="image/png,image/jpeg,image/webp" />
          </label>
          <p class="error" id="diaryError"></p>
          <button type="submit" class="btn btn-primary">日記を保存</button>
        </form>
      </article>

      <article class="card">
        <h3>検索・絞り込み（日記）</h3>
        <form id="diaryFilterForm" class="form two-col" novalidate>
          <label>開始日
            <input type="date" id="diaryFilterFrom" />
          </label>
          <label>終了日
            <input type="date" id="diaryFilterTo" />
          </label>
          <label>カテゴリ
            <select id="diaryFilterCategory">
              <option value="">すべて</option>
              <option value="event">イベント</option>
              <option value="health">健康</option>
              <option value="meal">食事</option>
              <option value="play">遊び</option>
              <option value="other">その他</option>
            </select>
          </label>
          <label>キーワード
            <input type="text" id="diaryFilterKeyword" placeholder="タイトル・本文・タグを検索" />
          </label>
          <label class="full">タグ
            <input type="text" id="diaryFilterTag" placeholder="例: 公園" />
          </label>
          <div class="full inline-actions">
            <button type="reset" class="btn btn-secondary">絞り込みをクリア</button>
          </div>
        </form>
      </article>

      <article class="card">
        <h3>日記一覧</h3>
        <div id="diaryList" class="list diary"></div>
      </article>
    </section>

    <section id="tab-graph" class="tab-panel" role="tabpanel" aria-labelledby="tab-btn-graph">
      <article class="card">
        <h2>成長グラフ（身長 / 体重）</h2>
        <p class="muted">実線: 実測値 / 点線: 3件移動平均</p>
        <canvas id="growthChart" width="900" height="320" aria-label="成長グラフ"></canvas>
        <div class="graph-legend">
          <span><i class="legend-line height"></i> 身長実測</span>
          <span><i class="legend-line height avg"></i> 身長移動平均</span>
          <span><i class="legend-line weight"></i> 体重実測</span>
          <span><i class="legend-line weight avg"></i> 体重移動平均</span>
        </div>
      </article>

      <article class="card card-grid-two">
        <section>
          <h3>月別記録件数</h3>
          <canvas id="monthlyCountChart" width="440" height="240" aria-label="月別記録件数"></canvas>
        </section>
        <section>
          <h3>カテゴリ比率</h3>
          <canvas id="categoryRatioChart" width="440" height="240" aria-label="カテゴリ比率"></canvas>
        </section>
      </article>

      <article class="card">
        <h2>分析カード</h2>
        <div id="analysisCards" class="analysis-grid"></div>
      </article>

      <article class="card">
        <h2>月次レポート</h2>
        <label>対象月
          <input type="month" id="reportMonth" />
        </label>
        <div id="monthlyReport" class="report-box"></div>
      </article>
    </section>

    <section id="tab-settings" class="tab-panel" role="tabpanel" aria-labelledby="tab-btn-settings">
      <article class="card">
        <h2>設定</h2>

        <div class="settings-block">
          <h3>表示</h3>
          <label class="toggle-label" for="themeToggle">
            <input id="themeToggle" type="checkbox" />
            ダークモード（ONでダーク / OFFでライト）
          </label>
          <label class="toggle-label" for="largeTextToggle">
            <input id="largeTextToggle" type="checkbox" />
            大きめ文字モード
          </label>
          <p class="muted">表示設定は保存され、次回起動時にも反映されます。</p>
        </div>

        <div class="settings-block">
          <h3>データ管理</h3>
          <p class="muted">データには schemaVersion が付与されます。バックアップとしてJSONを保存できます。</p>

          <div class="data-cards">
            <section class="data-card export-card" aria-label="エクスポート">
              <h4>📤 エクスポート</h4>
              <p class="muted">現在のプロフィール・記録・日記をJSONファイルとして保存します。</p>
              <button id="exportJson" type="button" class="btn btn-primary">JSONエクスポート</button>
            </section>

            <section class="data-card import-card" aria-label="インポート">
              <h4>📥 インポート</h4>
              <p class="muted">バックアップJSONを読み込み、データを復元します。</p>
              <div class="settings-actions">
                <label class="import-label btn btn-secondary">
                  ファイルからインポート
                  <input id="importJsonFile" type="file" accept="application/json,.json" />
                </label>
              </div>
              <textarea id="importJsonText" rows="6" placeholder="ここにJSONを貼り付けて、下のボタンから復元できます"></textarea>
              <button id="importJsonTextBtn" type="button" class="btn btn-secondary">テキストからインポート</button>
            </section>
          </div>

          <p class="error" id="settingsError"></p>
        </div>

        <div class="settings-block danger-zone">
          <h3>危険操作</h3>
          <p class="muted">すべてのデータを削除します。元に戻せません。</p>
          <button id="clearAll" class="btn btn-danger" type="button">全データ削除</button>
        </div>
      </article>
    </section>
  </main>

  <template id="growthItemTpl">
    <article class="item">
      <div>
        <strong class="date"></strong>
        <p class="meta"></p>
        <div class="chips"></div>
      </div>
      <button class="btn btn-danger small delete-growth" type="button">削除</button>
    </article>
  </template>

  <template id="diaryItemTpl">
    <article class="item diary-item">
      <div class="diary-content">
        <strong class="date"></strong>
        <p class="title"></p>
        <p class="text"></p>
        <div class="chips"></div>
        <img class="photo" alt="日記写真" />
      </div>
      <button class="btn btn-danger small delete-diary" type="button">削除</button>
    </article>
  </template>

  <div id="onboardingModal" class="onboarding-overlay" role="dialog" aria-modal="true" aria-labelledby="onboardingTitle" hidden>
    <div class="onboarding-card">
      <p class="step-indicator"><span id="onboardingStepNow">1</span> / 3</p>
      <h2 id="onboardingTitle">ようこそ！3ステップで使い方を確認</h2>
      <div id="onboardingStep1" class="onboarding-step active">
        <h3>① まずプロフィールを保存</h3>
        <p>お名前と生年月日を登録すると、年齢表示や記録がわかりやすくなります。</p>
      </div>
      <div id="onboardingStep2" class="onboarding-step">
        <h3>② 成長記録を追加</h3>
        <p>身長・体重は日付付きで保存。グラフタブで推移を確認できます。</p>
      </div>
      <div id="onboardingStep3" class="onboarding-step">
        <h3>③ 日記とバックアップ</h3>
        <p>写真付き日記も保存可能。設定タブからJSONバックアップができます。</p>
      </div>
      <div class="onboarding-actions">
        <button type="button" id="onboardingPrev" class="btn btn-secondary">戻る</button>
        <button type="button" id="onboardingNext" class="btn btn-primary">次へ</button>
        <button type="button" id="onboardingClose" class="btn btn-primary">はじめる</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>